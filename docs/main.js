(()=>{var e,t={},n=t&&t.__extends||(e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)},function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.Types=t.Model=void 0;var r={};Object.defineProperty(r,"__esModule",{value:!0}),r.Types=r.Model=void 0;var o={},a=o&&o.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=o&&o.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function c(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}u((r=r.apply(e,t||[])).next())}))},c=o&&o.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(c){return function(u){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,u])}}};Object.defineProperty(o,"__esModule",{value:!0}),o.Model=void 0;var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}var n;return a(t,e),t.__ns__=function(){var e;return null!==(e=this.__namespace__)&&void 0!==e?e:this.name},t.useStorage=function(e){this.__area__=e},t.__rawdict__=function(){return i(this,void 0,void 0,(function(){var e;return c(this,(function(t){switch(t.label){case 0:return e=this.__ns__(),[4,this.__area__.get(e)];case 1:return[2,(t.sent()||{})[e]||{}]}}))}))},t.new=function(e,t){var n=new this(e);return n._id=null!=t?t:null,Object.entries(e||{}).map((function(e){var t=e[0],r=e[1];n[t]=r})),n},t.create=function(e){return i(this,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return[4,this.new(e).save()];case 1:return[2,t.sent()]}}))}))},t.list=function(){return i(this,void 0,void 0,(function(){var e,t,n,r,o,a,i,u;return c(this,(function(c){switch(c.label){case 0:return[4,this.__rawdict__()];case 1:for(o in e=c.sent(),t=[],r=[],n=e)r.push(o);a=0,c.label=2;case 2:return a<r.length?(o=r[a])in n?(i=o,[4,(u=this.new(e[i],i)).decode(e[i])]):[3,4]:[3,5];case 3:c.sent(),t.push(u),c.label=4;case 4:return a++,[3,2];case 5:return[2,t]}}))}))},t.filter=function(e){return i(this,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return[4,this.list()];case 1:return[2,t.sent().filter(e)]}}))}))},t.find=function(e){return i(this,void 0,void 0,(function(){var t,n;return c(this,(function(r){switch(r.label){case 0:return[4,this.__rawdict__()];case 1:return(t=r.sent())[e]?[4,(n=this.new(t[e],e)).decode(t[e])]:[2,null];case 2:return r.sent(),[2,n]}}))}))},t.drop=function(){return i(this,void 0,void 0,(function(){var e;return c(this,(function(t){switch(t.label){case 0:return[4,this.__area__.set((e={},e[this.__ns__()]={},e))];case 1:return t.sent(),[2]}}))}))},t.prototype.save=function(){return i(this,void 0,void 0,(function(){var e,t,n;return c(this,(function(r){switch(r.label){case 0:return[4,(e=this.constructor).__rawdict__()];case 1:return t=r.sent(),this._id||(this._id=e.__nextID__(t)),t[this._id]=this,[4,e.__area__.set((n={},n[e.__ns__()]=t,n))];case 2:return r.sent(),[2,this]}}))}))},t.prototype.delete=function(){return i(this,void 0,void 0,(function(){var e,t,n;return c(this,(function(r){switch(r.label){case 0:return[4,(e=this.constructor).__rawdict__()];case 1:return delete(t=r.sent())[this._id],[4,e.__area__.set((n={},n[e.__ns__()]=t,n))];case 2:return r.sent(),delete this._id,[2,this]}}))}))},t.prototype.update=function(e){return i(this,void 0,void 0,(function(){var t=this;return c(this,(function(n){return Object.keys(e).map((function(n){t.hasOwnProperty(n)&&(t[n]=e[n])})),[2,this.save()]}))}))},t.prototype.decode=function(e){return i(this,void 0,void 0,(function(){var t,n,r,o,a,i,u,l;return c(this,(function(c){switch(c.label){case 0:for(o in t=this.constructor.schema,r=[],n=t)r.push(o);a=0,c.label=1;case 1:return a<r.length?(o=r[a])in n?(i=o,this.hasOwnProperty(i)&&e.hasOwnProperty(i)?"function"!=typeof t[i].load?[3,3]:(u=this,l=i,[4,t[i].load(e[i])]):[3,4]):[3,4]:[3,5];case 2:return u[l]=c.sent(),[3,4];case 3:this[i]=e[i],c.label=4;case 4:return a++,[3,1];case 5:return[2,this]}}))}))},t.__area__=null===(n=null===chrome||void 0===chrome?void 0:chrome.storage)||void 0===n?void 0:n.local,t.schema={},t}(function(){function e(){}var t;return e.timestampID=function(){return String(Date.now())},e.sequentialID=function(e){void 0===e&&(e={});var t=Object.keys(e).map((function(e){return parseInt(e,10)})).sort((function(e,t){return e<t?-1:1})).pop();return String((t||0)+1)},t=e,e.__nextID__=t.timestampID,e}());o.Model=u,Object.defineProperty(r,"Model",{enumerable:!0,get:function(){return o.Model}});var l={};Object.defineProperty(l,"__esModule",{value:!0}),l.Types=void 0;var s={};Object.defineProperty(s,"__esModule",{value:!0}),s.createPrimitiveTypeChecker=void 0,s.createPrimitiveTypeChecker=function(e,t){var n=function(n,r,o){if(void 0===r){if(n)throw new Error("".concat(o," is marked as required"));return null}if(!t(r))throw new Error("".concat(o," is not ").concat(e));return null},r=n.bind(null,!1);return r.isRequired=n.bind(null,!0),r};var f={};Object.defineProperty(f,"__esModule",{value:!0}),f.createDateTypeChecker=void 0,f.createDateTypeChecker=function(){var e=function(e,t,n){if(void 0===t){if(e)throw new Error("".concat(n," is marked as required, but got undefined"));return null}if("function"==typeof t.constructor&&"Date"===t.constructor.name)return null;throw new Error("".concat(n," is supposed to be Date, but got ").concat(t.constructor.name))},t=e.bind(null,!1);return t.isRequired=e.bind(null,!0),t.load=function(e){return new Date(e)},t};var d={},p=d&&d.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function c(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}u((r=r.apply(e,t||[])).next())}))},h=d&&d.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(c){return function(u){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,u])}}};Object.defineProperty(d,"__esModule",{value:!0}),d.modelTypeChecker=void 0,d.modelTypeChecker=function(e,t){var n=this;void 0===t&&(t={});var r=function(e,t,n){if(void 0===t){if(e)throw new Error("".concat(n," is marked as required"));return null}return null},o=r.bind(null,!1);return o.isRequired=r.bind(null,!0),o.ref=e,o.load=function(e){return p(n,void 0,void 0,(function(){var n;return h(this,(function(r){switch(r.label){case 0:return t.eager?[3,2]:[4,(n=o.ref.new(e,e._id)).decode(e)];case 1:return r.sent(),[2,n];case 2:return e?void 0===e._id?[2]:[4,o.ref.find(e._id)]:[2];case 3:return[2,r.sent()]}}))}))},o.isRequired.load=o.load,o};var v={},m=v&&v.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function c(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}u((r=r.apply(e,t||[])).next())}))},_=v&&v.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(c){return function(u){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,u])}}};Object.defineProperty(v,"__esModule",{value:!0}),v.arrayOfTypeChecker=void 0,v.arrayOfTypeChecker=function(e){var t=this,n=function(e,t,n){return null},r=n.bind(null,!1);return r.isRequired=n.bind(null,!0),r.load=function(n){return m(t,void 0,void 0,(function(){var t,r,o,a,i,c;return _(this,(function(u){switch(u.label){case 0:if(n instanceof Array==0)return[2,[]];t=[],r=0,o=n,u.label=1;case 1:return r<o.length?(a=o[r],"function"!=typeof e.load?[3,3]:(c=(i=t).push,[4,e.load(a)])):[3,5];case 2:return c.apply(i,[u.sent()]),[3,4];case 3:t.push(a),u.label=4;case 4:return r++,[3,1];case 5:return[2,t]}}))}))},r},l.Types={bool:(0,s.createPrimitiveTypeChecker)("bool",(function(e){return"boolean"==typeof e})),number:(0,s.createPrimitiveTypeChecker)("number",(function(e){return"number"==typeof e})),string:(0,s.createPrimitiveTypeChecker)("string",(function(e){return"string"==typeof e})),object:(0,s.createPrimitiveTypeChecker)("object",(function(e){return"object"==typeof e})),array:(0,s.createPrimitiveTypeChecker)("array",(function(e){return Array.isArray(e)})),date:(0,f.createDateTypeChecker)(),model:d.modelTypeChecker,arrayOf:v.arrayOfTypeChecker},Object.defineProperty(r,"Types",{enumerable:!0,get:function(){return l.Types}});var y={};Object.defineProperty(y,"__esModule",{value:!0}),y.use=void 0,y.use=function(e){return function(e){function t(t,n){var r=[],o=null;0==arguments.length?r=Object.keys(e):t instanceof Function?o=t:t instanceof Array?r=t:t&&(r=[t]),n instanceof Function&&(o=n);var a=r.reduce((function(t,n){var r;return t+n.length+((null===(r=e.getItem(n))||void 0===r?void 0:r.length)||0)}),0);if(!o)return Promise.resolve(a);o(a)}function n(t){if(e.clear(),!t)return Promise.resolve();t()}function r(t,n){if(Object.entries(t).map((function(t){var n=t[0],r=t[1];return e.setItem(n,JSON.stringify(r))})),!n)return Promise.resolve();n()}function o(t,n){if((t instanceof Array?t:[t]).map((function(t){return e.removeItem(t)})),!n)return Promise.resolve();n()}function a(t,n){var r=[],o=null,a={};0==arguments.length?r=Object.keys(e):t instanceof Function?(r=Object.keys(e),o=t):"string"==typeof t?r=[t]:t instanceof Array?r=t:t instanceof Object&&(a=t,0==(r=Object.keys(t)).length&&(r=Object.keys(e))),n instanceof Function&&(o=n);var i=r.reduce((function(t,n){return t[n]=JSON.parse(e.getItem(n)||"null")||a[n]||null,t}),{});if(!o)return Promise.resolve(i);o(i)}function i(e,t){if(!t)return Promise.resolve();t()}function c(e,t){}function u(e,t){}function l(e,t){}var s=null;return{getBytesInUse:t,clear:n,set:r,remove:o,get:a,setAccessLevel:i,onChanged:{addListener:function(e){s=e},hasListener:function(e){return!!s&&s==e},hasListeners:function(){return!!s},removeListener:function(e){this.hasListener(e)&&(s=null)},getRules:c,addRules:u,removeRules:l}}}(e)};var b=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.__area__=y.use(globalThis.localStorage),t}(r.Model);t.Model=b,Object.defineProperty(t,"Types",{enumerable:!0,get:function(){return l.Types}});class w extends t.Model{static __namespace__="Item"}const g=({item:e,refresh:t})=>{const n=1==e.status?{textDecoration:"line-through"}:{};return React.createElement("div",{className:"row"},React.createElement("div",{className:"column column-60"},React.createElement("div",{style:n},e.title),React.createElement("div",{style:{fontSize:"xx-small"}},"id:",e._id," status:",e.status)),React.createElement("div",{className:"column column"},0==e.status?React.createElement("a",{className:"button",onClick:async()=>await e.update({status:1})&&t()},"DONE"):React.createElement("a",{className:"button button-clear",onClick:async()=>await e.update({status:0})&&t()},"UNDO")),React.createElement("div",{className:"column column"},React.createElement("a",{className:"button button-outline",onClick:async()=>await e.delete()&&t()},"DELETE")))},E=()=>{const e=()=>{window.location.reload()},[t,n]=React.useState([]),[r,o]=React.useState("");return React.useEffect((()=>w.list().then(n)),[]),React.createElement("div",{className:"container",style:{paddingTop:"16px"}},React.createElement("div",{className:"row"},React.createElement("div",{className:"column"},React.createElement("h1",null,"TODO App Example by ",React.createElement("a",{href:"https://github.com/otiai10/jstorm"},"jstorm")))),React.createElement("div",{className:"row"},React.createElement("div",{className:"column"},React.createElement("pre",null,React.createElement("code",null,'// Import from "jstorm/browser/local" for localStorage:\nimport { Model } from "jstorm/browser/local";\n\n// Define your model:\nclass Item extends Model {\n    static override __namespace__ = "Item";\n    public title: string;\n    public status: number;\n}\n\n// Now, let\'s begin:')))),React.createElement("div",{className:"row"},React.createElement("div",{className:"column column-40"},React.createElement("input",{type:"text",placeholder:"New item title here",onChange:e=>o(e.target.value)})),React.createElement("div",{className:"column"},React.createElement("input",{type:"button",value:"ADD",onClick:async()=>await w.create({title:r,status:0})&&e()})),React.createElement("div",{className:"column column-40"},React.createElement("pre",null,React.createElement("code",null,"// Insert new item:\nconst item = await Item.create({title: text, status: 0})")))),React.createElement("div",{className:"row"},React.createElement("div",{className:"column column-60"},t.map((t=>React.createElement(g,{key:t._id,item:t,refresh:e})))),React.createElement("div",{className:"column column-40"},React.createElement("pre",null,React.createElement("code",null,"// Update:\nitem.update({status: 1});\n\n// Delete:\nitem.delete();")))))},O=document.getElementById("root");ReactDOM.createRoot(O).render(React.createElement(E,null))})();